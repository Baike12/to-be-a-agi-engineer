#### 交换内存
- 在磁盘上，将内存中暂时用不到的数据页交换到磁盘上让出内存给需要的程序
#### 缺页中断
- 程序访问不在物理内存中的页面时，cpu触发一个中断，操作系统处理中断，将页面加载到物理内存中
- 发生时机
	- 首次访问一个页面
	- 已经被换出的页面再次访问
	- malloc分配内存时
### 页表
- 包含页号和页内偏移
#### 多级页表
- 一级页表有1024项，里面装的是一级页号和二级页表地址，可以覆盖整个内存区域
- 二级页表按需创建，用不到的就不创建，节省了页表消耗的内存
- 64位系统有四级页表
#### TLB
- 用于缓存最常访问的页表项
### 段页式内存管理
- 先找到段号、再找页号、最后找数据
### linux内存空间
#### 32位
- 低3G是用户空间
- 高1G是内核空间
#### 64位
- 低128T是用户空间
- 高128T是内核空间

### 动态内存分配
#### brk
- 将堆顶指针上移动
- 适用于简单场景，128K以下内存
#### mmap
- 从内存映射区获取内存，将文件映射到内存中
- 可以用于共享内存
- 支持内存保护，可以标记为只读、不可执行等
#### 预分配
- malloc分配多于所需内存大小
#### 释放
- malloc的内存free后不会归还操作系统
- mmap的会
#### 只使用mmap
- 频繁的中断
- 缺页：mmap每次释放内存都会归还系统，于是每次分配的虚拟内存地址都是缺页状态，然后在第一次访问该虚拟地址的时候，就会触发缺页中断
#### 只使用brk
- 不归还给系统也是一个问题：内存碎片
#### free
- 每次malloc会包含大小信息（16字节）在返回的指针前面，释放的时候将指针向左偏移16字节就得到大小